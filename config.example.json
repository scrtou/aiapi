{
    "listeners": [
        {
            "address": "0.0.0.0",
            "port": 5555,
            "https": false
        }
    ],
    "db_clients":[
        {
            "name": "aichatpg",
            "rdbms": "postgresql",
            "host": "YOUR_DB_HOST",
            "port": 14539,
            "dbname": "aichat",
            "user": "YOUR_DB_USER",
            "passwd": "YOUR_DB_PASSWORD",
            "is_fast": false,
            "number_of_connections": 1,
            "timeout": -1.0,
            "auto_batch": false
        }
    ],
    "app": {
        "number_of_threads": 4,
        "enable_session": false,
        "session_timeout": 0,
        "session_same_site" : "Null",
        "session_cookie_key": "JSESSIONID",
        "session_max_age": -1,
        "document_root": "./",
        "home_page": "index.html",
        "use_implicit_page": true,
        "implicit_page": "index.html",
        "upload_path": "uploads",
        "file_types": [
            "gif",
            "png",
            "jpg",
            "js",
            "css",
            "html",
            "ico",
            "swf",
            "xap",
            "apk",
            "cur",
            "xml",
            "webp",
            "svg"
        ],
        "mime": {},
        "locations": [
            {
                "default_content_type": "text/plain",
                "alias": "",
                "is_case_sensitive": false,
                "allow_all": true,
                "is_recursive": true,
                "filters": []
            }
        ],
        "max_connections": 100000,
        "max_connections_per_ip": 0,
        "load_dynamic_views": false,
        "dynamic_views_path": [
            "./views"
        ],
        "dynamic_views_output_path": "",
        "json_parser_stack_limit": 1000,
        "enable_unicode_escaping_in_json": true,
        "float_precision_in_json": {
            "precision": 0,
            "precision_type": "significant"
        },
        "log": {
            "use_spdlog": true,
            "log_path": "logs",
            "logfile_base_name": "aiapi",
            "log_size_limit": 10000000,
            "max_files": 5,
            "log_level": "DEBUG",
            "display_local_time": true
        },
        "run_as_daemon": false,
        "handle_sig_term": true,
        "relaunch_on_error": false,
        "use_sendfile": true,
        "use_gzip": true,
        "use_brotli": false,
        "static_files_cache_time": 5,
        "idle_connection_timeout": 60,
        "server_header_field": "",
        "enable_server_header": true,
        "enable_date_header": true,
        "keepalive_requests": 0,
        "pipelining_requests": 0,
        "gzip_static": true,
        "br_static": true,
        "client_max_body_size": "1M",
        "client_max_memory_body_size": "64K",
        "client_max_websocket_message_size": "128K",
        "reuse_port": false,
        "enabled_compressed_request": false,
        "enable_request_stream": false,
        "cors": {
            "enabled": true,
            "allow_origins": ["*"],
            "allow_methods": ["GET", "POST", "PUT", "DELETE", "OPTIONS", "PATCH"],
            "allow_headers": ["*"],
            "expose_headers": ["*"],
            "max_age": 3600,
            "allow_credentials": false
        }
    },
    "plugins": [
        {
            "name": "drogon::plugin::PromExporter",
            "dependencies": [],
            "config": {
                "path": "/metrics"
            }
        },
        {
            "name": "drogon::plugin::AccessLogger",
            "dependencies": [],
            "config": {
                "use_spdlog": true
            }
        }
    ],
    "custom_config": {
        "dbtype": "sqlite3",
        "dbtype_comment": "可选值: postgresql, mysql, sqlite3, 默认为 postgresql",
        "admin_api_key": "",
        "admin_api_key_comment": "设置后所有 /aichat/* 管理接口需要 Authorization: Bearer <key>；为空则跳过认证（向后兼容）",
        "session_tracking": {
            "mode": "zerowidth",
            "_comment": "可选值: 'hash' (基于消息内容哈希，默认) 或 'zerowidth' (基于零宽字符嵌入)"
        },
        "tool_bridge": {
            "definition_mode": "compact",
            "include_descriptions": false,
            "max_description_chars": 5000,
            "trigger_random_length": 8,
            "rewrite_user_input_conflicts": false,
            "strict_sentinel": true,
            "strict_sentinel_by_channel": {
                "openai": true,
                "chaynsapi": false
            },
            "strict_sentinel_by_model": {
                "gpt-4o-mini": true,
                "legacy-compat-model": false
            },
            "strict_sentinel_enabled_channels": [
                "openai"
            ],
            "strict_sentinel_disabled_channels": [
                "chaynsapi"
            ],
            "strict_sentinel_enabled_models": [
                "gpt-4o-mini"
            ],
            "strict_sentinel_disabled_models": [
                "legacy-compat-model"
            ],
             "_comment": "ToolBridge 示例策略：默认 strict_sentinel=true；按渠道/模型可放宽。trigger_random_length 建议 6-12。rewrite_user_input_conflicts 默认 false（避免改写用户原始输入）；若设为 true 会在 bridge 模式下改写当前用户输入中的 native 冲突指令。覆盖优先级：全局 strict_sentinel -> by_channel/by_model -> disabled/enabled 列表；但 strict 客户端或 tool_choice=required 会被强制为 true。"
        },
        "login_service_urls": [
            {
                "name": "chaynsapi",
                "url": "http://aiapi-tool:5557/aichat/chayns/login"
            }
        ],
        "regist_service_urls": [
            {
                "name": "chaynsapi",
                "url": "http://aiapi-tool:5557/aichat/chayns/autoregister"
            }
        ],
        "providers": {
            "openai": {
                "api_key": "",
                "base_url": "https://api.openai.com",
                "default_model": "gpt-4o-mini"
            }
        },
        "upstream_error_texts": [
            "Es ist ein Fehler aufgetreten. Bitte versuche es später erneut.",
            "An error has occurred. Please try again later."
        ],
        "upstream_error_texts_comment": "上游错误文本列表：当轮询到的响应文本完全匹配其中任一条时，视为上游错误并触发重试",
        "response_index": {
            "max_entries": 200000,
            "max_age_hours": 6,
            "cleanup_interval_minutes": 10
        },
        "rate_limit": {
            "enabled": true,
            "requests_per_second": 10,
            "burst": 20
        },
        "cors": {
            "allowed_origins": ["*"],
            "allowed_headers": ["*"],
            "allowed_methods": ["GET", "POST", "PUT", "DELETE", "OPTIONS", "PATCH"],
            "expose_headers": ["*"],
            "max_age": 3600,
            "allow_credentials": false
        }
    }
}
